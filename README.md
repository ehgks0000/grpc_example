# gRpc 연습

## 실행 방법

1.

```
$ yarn build:proto
$ yarn build

// 서버 실행
// nf -e .env yarn start
// 위 명령어로 `env` 파일을 같이 실행
$ yarn start

$ yarn ./dist/client/get-song.js // 클라 실행
```

> 실행 시 proto가 컴파일 된다.

## 기록

1. 디펜던시 버전마다 사용 방법이 많이 상이하니 주의
2. ~~컴파일 후 `./src/proto`를 생성이 되면 오류가 발생하는데 `grpc`를 `@grpc/grpc-js`로 수정 해주어야 한다.~~

   > 참조  
   > https://medium.com/expedia-group-tech/the-weird-world-of-grpc-tooling-for-node-js-part-1-40a442966876  
   > https://www.npmjs.com/package/@grpc/grpc-js

   > > scripts 수정으로 수정 안해주어도 된다.

3. grpc와 @grpc/grpc-js의 차이점

> grpc : 기본 grpc에 대한 JavaScript 바인딩을 제공하는 라이브러리입니다. node-gyp을 사용하여 기본 런타임 라이브러리를 Node.js API에 통합하며, Node.js gRPC 서버에 대해 유일하게 널리 사용되는 런타임입니다.

> @grpc/grpc-js : 문서에 따르면 `grpc-js`는 다음과 같습니다.

- 순수 자바스크립트 gRPC 클라이언트
- 베타 수준의 release
- `grpc-js`는 `@grpc/proto-loader`에 의존해 `.proto`를 처리합니다.

> > `grpc`로 부터 Migration
> > 2번째 3번째 참고하면 됩니다.

- If you are currently loading .proto files using grpc.load, that function is not available in this library. You should instead load your .proto files using @grpc/proto-loader and load the resulting package definition objects into @grpc/grpc-js using grpc.loadPackageDefinition.

- If you are currently loading packages generated by grpc-tools, you should instead generate your files using the generate_package_definition option in grpc-tools, then load the object exported by the generated file into @grpc/grpc-js using grpc.loadPackageDefinition.

* If you have a server and you are using Server#bind to bind ports, you will need to use Server#bindAsync instead.

## Reference

1. https://medium.com/blokur/how-to-implement-a-grpc-client-and-server-in-typescript-fa3ac807855e
2. https://github.com/blokur/grpc-ts-demo
